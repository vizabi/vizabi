(function(){"use strict";function a(a,b,d){var e=c.Tool.get(a);if(e){var f=new e(b,d);return c._instances[f._id]=f,f}c.utils.error('Tool "'+a+'" was not found.')}var b=this,c=(b.Vizabi,function(b,c,d){return a(b,c,d)});c._instances={},c.clearInstances=function(a){a?delete c._instances[a]:c._instances={}},c._require=function(a){return"undefined"==typeof b[a]?(c.utils.warn(a+" is required and could not be found."),!1):!0},"function"==typeof define&&define.amd?define(function(){return c}):"object"==typeof module&&module.exports&&(module.exports=c),b.Vizabi=c}).call(this),function(){"use strict";var a=this,b=a.Vizabi;b.utils={uniqueId:function(){var a=0;return function(b){return b?b+a++:a++}}(),isElement:function(a){return!(!a||1!==a.nodeType)},isArray:Array.isArray||function(a){return"[object Array]"===toString.call(a)},isObject:function(a){var b=typeof a;return"object"===b&&!!a},isDate:function(a){return a instanceof Date},isPlainObject:function(a){return null!=a&&"[object Object]"===Object.prototype.toString.call(a)},forEach:function(a,b,c){if(a)if(this.isArray(a)){var d;for(d=0;d<a.length&&b.apply(c,[a[d],d])!==!1;d++);}else for(var e in a)if(b.apply(c,[a[e],e])===!1)break},extend:function(a){var b=Array.prototype.slice.call(arguments,1),c=this;return this.forEach(b,function(b,d){c.forEach(b,function(c,d){b.hasOwnProperty(d)&&(a[d]=c)})}),a},merge:function(a){var b=Array.prototype.slice.call(arguments,1),c=this;return this.forEach(b,function(b,d){c.forEach(b,function(d,e){b.hasOwnProperty(e)&&(a.hasOwnProperty(e)?(c.isArray(a[e])||(a[e]=[a[e]]),a[e].push(d)):a[e]=d)})}),a},clone:function(a,b){if(this.isArray(a))return a.slice(0);var c={};return this.forEach(a,function(d,e){b&&-1===b.indexOf(e)||a.hasOwnProperty(e)&&(c[e]=d)}),c},deepClone:function(a){var b={},c=this;return this.forEach(a,function(d,e){a.hasOwnProperty(e)&&(c.isObject(d)||c.isArray(d)?b[e]=c.deepClone(d):b[e]=d)}),b},without:function(a,b){var c=a.indexOf(b);return-1!==c&&a.splice(c,1),a},unique:function(a,b){var c={},d=[];b||(b=function(a){return a});for(var e=0,f=a.length;f>e;++e){var g=b(a[e]);c.hasOwnProperty(g)||(d.push(a[e]),c[g]=1)}return d},find:function(a,b){var c;return this.forEach(a,function(a){return b(a)?(c=a,!1):void 0}),c},filter:function(a,b){return a.filter(function(a){for(var c in b)if(a[c]!==b[c])return!1;return!0})},timeStamp:function(b){a.console&&"function"==typeof a.console.timeStamp&&a.console.timeStamp(b)},warn:function(b){a.console&&"function"==typeof a.console.warn&&a.console.warn(b)},groupCollapsed:function(b){a.console&&"function"==typeof a.console.groupCollapsed&&a.console.groupCollapsed(b)},groupEnd:function(){a.console&&"function"==typeof a.console.groupEnd&&a.console.groupEnd()},error:function(b){a.console&&"function"==typeof a.console.error&&a.console.error(b)},countDecimals:function(a){return Math.floor(a.valueOf())===a.valueOf()?0:a.toString().split(".")[1].length||0},addClass:function(a,b){a.classList?a.classList.add(b):a.className+=" "+b},removeClass:function(a,b){a.classList?a.classList.remove(b):a.className=a.className.replace(new RegExp("(^|\\b)"+b.split(" ").join("|")+"(\\b|$)","gi")," ")},throttle:function(){var a={};return function(b,c){a[b]||(a[b]=!0,setTimeout(function(){a[b]=!1},c),b())}}(),hasClass:function(a,b){return a.classList?a.classList.contains(b):new RegExp("(^| )"+b+"( |$)","gi").test(a.className)},values:function(a){var b;for(var c in a)(b=b||[]).push(a[c]);return b},defer:function(a){setTimeout(a,1)},ajax:function(a){var b=new XMLHttpRequest;b.open(a.method,a.url,!0),"POST"===a.method&&b.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),b.onload=function(){if(b.status>=200&&b.status<400){var c=a.json?JSON.parse(b.responseText):b.responseText;a.success&&a.success(c)}else a.error&&a.error()},b.onerror=function(){a.error&&a.error()},b.send(a.data)},get:function(a,b,c,d,e){var b=[];this.forEach(b,function(a,c){b.push(c+"="+a)}),a=b.length?a+"?"+b.join("&"):a,this.ajax({method:"GET",url:a,success:c,error:d,json:e})},post:function(a,b,c,d,e){this.ajax({method:"POST",url:a,success:c,error:d,json:e,data:b})}}}.call(this),function(){"use strict";var a=this,b=a.Vizabi,c=b.utils;!function(a,b){"undefined"!=typeof module&&module.exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Promise=b.call(a)}(b,function(){function a(b){return this instanceof a?(this.status="pending",this.value,this.reason,this._resolves=[],this._rejects=[],g(b)&&b(this.resolve.bind(this),this.reject.bind(this)),this):new a(b)}function b(b,c){return c===b&&b.reject(new Error("TypeError")),c instanceof a?d(b,c):i(c)?e(b,c):b.resolve(c)}function d(a,b){var c=b.status;return"pending"===c&&b.then(a.resolve.bind(a),a.reject.bind(a)),"resolved"===c&&a.resolve(b.value),"rejected"===c&&a.reject(b.reason),promise}function e(a,c){var d,e=j(function(c){d||(b(a,c),d=!0)}),f=j(function(b){d||(a.reject(b),d=!0)});try{c.then.call(c,e,f)}catch(g){if(!d)throw g;a.reject(g)}return a}function f(a){for(var c,d,e=a.status,f=a["resolved"===e?"_resolves":"_rejects"],g=a["resolved"===e?"value":"reason"];c=f.shift();)d=c.call(a,g),d&&b(a._next,d);return a}function g(a){return"function"===h(a)}function h(a){var b={};return b.toString.call(a).replace(/\[object (\w+)\]/,"$1").toLowerCase()}function i(a){return a&&a.then&&g(a.then)}function j(a){var b,c;return function(){return b?c:(b=!0,c=a.apply(this,arguments))}}return a.prototype.then=function(c,d){var e,f=this._next||(this._next=a()),h=this.status;if("pending"===h)return g(c)&&this._resolves.push(c),g(d)&&this._rejects.push(d),f;if("resolved"===h){if(g(c))try{e=c(this.value),b(f,e)}catch(i){this.reject(i)}else f.resolve(c);return f}if("rejected"===h){if(g(d))try{e=d(this.reason),b(f,e)}catch(i){this.reject(i)}else f.reject(d);return f}},a.prototype.resolve=function(a){if("rejected"===this.status)throw Error("Illegal call.");return this.status="resolved",this.value=a,this._resolves.length&&f(this),this},a.prototype.reject=function(a){if("resolved"===this.status)throw Error("Illegal call.");return this.status="rejected",this.reason=a,this._rejects.length&&f(this),this},a.prototype["catch"]=function(a){return this.then(void 0,a)},a.cast=function(b){var c=a();return b instanceof a?d(c,b):a.resolve(b)},a.resolve=function(b){var c=a();return i(b)?e(c,b):c.resolve(b)},a.all=function(b){var d,e=b.length,f=a(),g=[],h=0;return c.forEach(b,function(a,b){a.then(function(a){g[b]=a,++h!==e||d||f.resolve(g)},function(a){d=!0,f.reject(a)})}),f},a.any=function(b){var d,e=a();return c.forEach(b,function(a,b){a.then(function(a){d||(e.resolve(a),d=!0)},function(a){d=!0,e.reject(a)})}),e},a.reject=function(b){if(!(b instanceof Error))throw Error("reason must be an instance of Error");var c=a();return c.reject(b),c},a})}.call(this),function(){"use strict";function a(b,f){function g(){!d&&this.init&&this.init.apply(this,arguments)}f=1===arguments.length?b:f;var h=this.prototype;d=!0;var i=new this;return d=!1,c.utils.forEach(f,function(a,b){"function"==typeof f[b]&&"function"==typeof h[b]&&e.test(f[b])?i[b]=function(a,b){return function(){var c=this._super;this._super=h[a];var d=b.apply(this,arguments);return this._super=c,d}}(b,f[b]):i[b]=a}),g.prototype=i,g.prototype.constructor=g,g.extend=a,g._collection={},g.register=function(a,b){"undefined"!=typeof this._collection[a]&&c.utils.warn('"'+a+'" is already registered. Overwriting...'),this._collection[a]=b},g.unregister=function(a){delete this._collection[a]},g.getCollection=function(){return this._collection},g.get=function(a,b){return this._collection.hasOwnProperty(a)?this._collection[a]:(b||c.utils.warn('"'+a+'" was not found.'),!1)},arguments.length>1&&this.register&&this.register(b,g),g}var b=this,c=b.Vizabi,d=!1,e=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;c.Class=function(){},c.Class.extend=a}.call(this),function(){"use strict";function a(a,b,c){return JSON.stringify(a)+b+JSON.stringify(c)}var b=this,c=b.Vizabi,d=c.utils,e=c.Promise,f={},g=c.Class.extend({init:function(){this._data={}},load:function(a,b,c,f){var g=this,h=new e,i=e.all([]),j=this.isCached(a,b,c),k=!1;return j||(d.timeStamp("Vizabi Data: Loading Data"),f&&"function"==typeof f.load_start&&f.load_start(),i=new e,this.loadFromReader(a,b,c).then(function(a){k=!0,j=a,i.resolve()})),i.then(function(){var a=g.get(j);h.resolve(a),k&&f&&"function"==typeof f.load_end&&f.load_end()},function(){h.reject("Error loading file..."),k&&f&&"function"==typeof f.load_end&&f.load_end()}),h},loadFromReader:function(b,c,g){var h=this,i=new e,j=g.reader,k=a(b,c,g);if(!f.hasOwnProperty(j))return void d.error("Vizabi Reader "+j+" not found");var l=new f[j](g);return l.read(b,c).then(function(){var a=l.getData(),c=b,d=-1!==c.select.indexOf("geo.region");a=a.map(function(a){for(var b=0;b<c.select.length;b++){var d=c.select[b];"undefined"==typeof a[d]&&(a[d]=null)}return a}),a=a.map(function(a){return null===a.geo&&(a.geo=a["geo.name"]),d&&null===a["geo.region"]&&(a["geo.region"]=a.geo),a}),a=a.map(function(a){return a.time=new Date(a.time),a.time.setHours(0),a}),a.sort(function(a,b){return a.time-b.time}),h._data[k]=a,i.resolve(k)},function(a){i.reject(a)}),i},get:function(a){return a?this._data[a]:this._data},isCached:function(b,c,d){var e=a(b,c,d);return-1!==Object.keys(this._data).indexOf(e)?e:!1},clear:function(){this._data={}}}),h=c.Class.extend({init:function(a){this._name=this._name||a.reader,this._data=a.data||[],this._basepath=this._basepath||a.path||null},read:function(a,b){return new e.resolve(this._data)},getData:function(){return this._data}});f=h._collection,c.Reader=h,c.Data=g}.call(this),function(){"use strict";var a=this,b=a.Vizabi,c=b.utils,d=!1,e=[],f={},g=b.Class.extend({init:function(a,b){this._id=this._id||c.uniqueId("e"),this._events={},this._freeze=!1,this._freezer=[],this._freezeExceptions={}},on:function(a,b){var d;if(c.isArray(b))for(d=0;d<b.length;d++)this.on(a,b[d]);else if(c.isArray(a))for(d=0;d<a.length;d++)this.on(a[d],b);else if(c.isObject(a))for(d in a)this.on(d,a[d]);else this._events[a]=this._events[a]||[],"function"==typeof b?this._events[a].push(b):c.warn("Can't bind event '"+a+"'. It must be a function.")},unbind:function(a){if(c.isArray(a))for(var b=0;b<a.length;b++)this.unbind(a[b]);else this._events.hasOwnProperty(a)&&(this._events[a]=[])},unbindAll:function(){this._events={}},trigger:function(a,b,g){var h;if(c.isArray(a))for(h=0,size=a.length;h<size;h++)this.trigger(a[h],b);else{if(!this._events.hasOwnProperty(a))return;for(h=0;h<this._events[a].length;h++){var i=this._events[a][h],j=this,k=function(){var d="Vizabi Event: "+a+" - "+g;c.timeStamp(d),i.apply(j,[g||a,b])};this._freeze||d?d&&f.hasOwnProperty(a)||!d&&this._freeze&&this._freezeExceptions.hasOwnProperty(a)?k():(this._freezer.push(k),d&&!e[this._id]&&(this.freeze(),e[this._id]=this)):k()}}},triggerAll:function(a,b){if(c.isArray(a))for(var d=0,e=a.length;e>d;d++)this.triggerAll(a[d],b);else for(var f=a,g=a.split(":");g.length;)this.trigger(a,b,f),g.pop(),a=g.join(":")},freeze:function(a){if(this._freeze=!0,a){c.isArray(a)||(a=[a]);for(var b=0;b<a.length;b++)this._freezeExceptions[a[b]]=!0}},unfreeze:function(){for(this._freeze=!1,this._freezeExceptions={};this._freezer.length;){var a=this._freezer.shift();a()}}});g.freezeAll=function(a){d=!0,a&&(c.isArray(a)||(a=[a]),c.forEach(a,function(a){f[a]=!0}))},g.unfreezeAll=function(){d=!1,f={};for(var a in e){var b=e[a];b.unfreeze(),delete e[a]}},b.Events=g}.call(this),function(){"use strict";var a=this,b=a.Vizabi,c=(b.utils,b.Class.extend({init:function(){this.intervals={}},setInterval:function(a,b,c){this.clearInterval(a),this.intervals[a]=setInterval(b,c)},clearInterval:function(a){return a?clearInterval(this.intervals[a]):this.clearAllIntervals()},clearAllIntervals:function(){for(var a in this.intervals)this.clearInterval(a)}}));b.Intervals=c}.call(this),function(){"use strict";var a=this,b=a.Vizabi,c=b.utils,d="vzb-",e="vzb-portrait",f="vzb-landscape",g={small:{min_width:0,max_width:749},medium:{min_width:750,max_width:969},large:{min_width:970,max_width:1/0}},h=b.Events.extend({init:function(){this._container=null,this._curr_profile=null,this._prev_size={};var b=this;a.addEventListener("resize",function(){b.container&&b.setSize()}),this._super()},setSize:function(){var a=this,b=this._container.clientWidth,h=this._container.clientHeight;this._prev_size&&this._prev_size.width===b&&this._prev_size.height===h||(c.forEach(g,function(e,f){c.removeClass(a._container,d+f),b>=e.min_width&&b<=e.max_width&&(a._curr_profile=f)}),c.addClass(this._container,d+this._curr_profile),h>b?(c.addClass(this._container,e),c.removeClass(this._container,f)):(c.addClass(this._container,f),c.removeClass(this._container,e)),this._prev_size.width=b,this._prev_size.height=h,this.trigger("resize"))},setContainer:function(a){this._container=a,this.setSize()},currentProfile:function(){return this._curr_profile}});b.Layout=h}.call(this),function(){"use strict";function a(a){return a.hasOwnProperty("_data")}function b(a){for(var b in a._data)Object.defineProperty(a,b,{configurable:!0,get:function(b){return function(){return a.get(b)}}(b),set:function(b){return function(c){return a.set(b,c)}}(b)})}function c(b,c,d){var e=b.split("_")[0],f={set:function(a,b){},init:function(a,b){},change:function(a,b){a=a.replace("change","change:"+e),d.triggerAll(a,d.getObject())},load_start:function(a,b){a=a.replace("load_start","load_start:"+e),d.triggerAll(a,d.getObject())},load_error:function(a,b){a=a.replace("load_error","load_error:"+e),d.triggerAll(a,b)},ready:function(a,b){a=a.replace("ready","ready:"+e),d.trigger(a,b),d.setReady()}};if(a(c))return c.on(f),c;var g=j.Model.get(e,!0)||o;return new g(c,d,f)}function d(a){return a._intervals?a._intervals:a._parent?d(a._parent):new j.Intervals}function e(a,b){var c=f(a,b);return c?c:a._parent?e(a._parent,b):void 0}function f(b,c){for(var d in b._data)if(d===c&&a(b._data[d]))return b._data[d]}function g(a){return l.isArray(a.dimensions)?a.dimensions:a._parent?g(a._parent):void l.error('ERROR: dimensions not found.\n You must specify the objects this hook will use under the dimensions attribute in the state.\n Example:\n dimensions: ["entities", "time"]')}function h(a,b,c,d){if(null==a._items||0==a._items.length)return l.warn("interpolateValue returning NULL because items array is empty"),null;var e=new Date(b.time);delete b.time;var f=a._getFilteredItems(b);if("value"==c)return f[0][a[n]];var g=d3.bisectLeft(f.map(function(a){return a.time}),e);if("property"==c&&0==g)return f[0][d];if("property"==c)return f[g-1][d];if(0==g)return f[0][d];if(g==f.length)return f[f.length-1][d];if(null==f[g][d]||null==f[g-1][d])return null;var h=(e-f[g-1].time)/(f[g].time-f[g-1].time),d=+f[g-1][d]+(f[g][d]-f[g-1][d])*h;return"[object Date]"===Object.prototype.toString.call(f[0][d])&&(d=new Date(d)),d}var i=this,j=i.Vizabi,k=j.Promise,l=j.utils,m="use",n="value";j._require("d3");var o=j.Events.extend({init:function(a,b,c){this._type=this._type||"model",this._id=this._id||l.uniqueId("m"),this._data={},this._parent=b,this._set=!1,this._ready=!1,this._readyOnce=!1,this._loadedOnce=!1,this._loading=[],this._intervals=d(this),this._deps={parent:[],children:[]},this._hooks={},this._items=[],this._unique={},this._filtered={},this._limits={},this._super(),c&&this.on(c),a&&this.set(a)},get:function(a){return a?this._data[a]:this._data},set:function(d,e,f){var g,h=[],i=this._setting,j=this;l.isPlainObject(d)?(g=d,f=e):(g={})[d]=e,i||(this._prevData=l.clone(this._data),this._changedData={}),this._setting=!0,this.setReady(!1);for(var k in g){var e=g[k],m=this._data[k],n=this._prevData[k];if(!l.isPlainObject(e)||l.isArray(e)){if(m!==e||f||JSON.stringify(m)!==JSON.stringify(e)){var o="undefined"==typeof m?"init":"change";h.push(o+":"+k)}n!==e||f||JSON.stringify(n)!==JSON.stringify(e)?this._changedData[k]=e:delete this._changedData[k],this._data[k]=e}else m&&a(m)?(h.push("change:"+k),this._data[k].set(e,f)):(h.push("init:"+k),this._data[k]=c(k,e,this))}b(this),this.validate&&!i&&this.validate(),(!i||f)&&(this._set?h.length&&h.push("change"):(this._set=!0,h.push("set")),j.triggerAll(h,j.getObject()),j._setting=!1,this.isHook()||this.setReady())},getType:function(){return this._type},getSubmodels:function(){var a=[];return l.forEach(this._data,function(b){b&&"undefined"!=typeof b._id&&a.push(b)}),a},getObject:function(){var a={};for(var b in this._data)this._data[b]&&"function"==typeof this._data[b].getObject?a[b]=this._data[b].getObject():a[b]=this._data[b];return a},clear:function(){var a=this.getSubmodels();for(var b in a)a[b].clear();this.setReady(!1),this.unbindAll(),this._intervals.clearAllIntervals(),this._data={}},validate:function(){},isLoading:function(a){if(this.isHook()&&!this._loadedOnce)return!0;if(a)return-1!==this._loading.indexOf(a);if(this._loading.length>0)return!0;var b,c=this.getSubmodels();for(b=0;b<c.length;b++)if(c[b].isLoading())return!0;for(b=0;b<this._deps.children.length;b++){var d=this._deps.children[b];if(d.isLoading()||!d._ready)return!0}return!1},setLoading:function(a){this.isLoading()||this.trigger("load_start"),this._loading.push(a)},setLoadingDone:function(a){this._loading=l.without(this._loading,a),this.setReady()},setReady:function(a){if(a===!1)return this._ready=!1,void(this._parent&&this._parent.setReady&&this._parent.setReady(!1));if(this._ready=!this.isLoading()&&!this._setting&&!this._loadCall,this._ready){this._readyOnce||(this._readyOnce=!0,this.trigger("readyOnce")),this.trigger("ready");for(var b=0;b<this._deps.parent.length;b++)this._deps.parent[b].setReady()}},load:function(){var a=this,b=this.getSubmodels(),c=this._dataModel,d=this._languageModel,e=this.getQuery(),f=new k,g=[];if(this._loadCall=!0,this.isHook()&&c&&e){var h=c.getObject(),i=d?d.id:"en",m=new k,n={load_start:function(){a.setLoading("_hook_data"),j.Events.freezeAll(["load_start","resize","dom_ready"])},load_end:function(){j.Events.unfreezeAll(),a.setLoadingDone("_hook_data")}};l.timeStamp("Vizabi Model: Loading Data: "+a._id),this._dataManager.load(e,i,h,n).then(function(b){a._items=b,l.timeStamp("Vizabi Model: Data loaded: "+a._id),a._unique={},a._filtered={},a._limits={},a.afterLoad(),m.resolve()},function(b){a.trigger("load_error",e),m.reject(b)}),g.push(m)}for(var o in b)g.push(b[o].load());var p=g.length?k.all(g):new k.resolve;return p.then(function(){a.validate&&a.validate(),l.timeStamp("Vizabi Model: Model loaded: "+a._id),a._loadedOnce=!0,a._loadCall=!1,a.setReady(),f.resolve()}),f},afterLoad:function(){},resetDeps:function(){this._deps.children=[]},addDep:function(a){this._deps.children.push(a),a._deps.parent.push(this)},isHook:function(){return this[m]?!0:!1},setHooks:function(){this.isHook()&&(this.dimensions=g(this),this.hookModel());var a=this.getSubmodels();l.forEach(a,function(a){a.setHooks()})},hookModel:function(){var a=this;this._dataManager=new j.Data,this._dataModel=e(this,"data"),this._languageModel=e(this,"language"),l.forEach(this.dimensions,function(b){a._hooks[b]=e(a,b),a._hooks[b].show&&a._hooks[b].on("change:show",function(b){a.load()})}),this.on("change",function(){a.load()})},getHook:function(a){return this._hooks[a]},getHookValues:function(a){var b=[];return this[m]&&this[m]===a&&b.push(this[n]),l.forEach(this.getSubmodels(),function(c){b=l.unique(b.concat(c.getHookValues(a)))}),b},getIndicators:function(){return this.getHookValues("indicator")},getProperties:function(){return this.getHookValues("property")},getAllDimensions:function(){var a,b=[];return l.forEach(this._hooks,function(c){(a=c.getDimension())&&b.push(a)}),b},getAllFilters:function(){var a={};return l.forEach(this._hooks,function(b){a=l.extend(a,b.getFilter())}),a},getValue:function(a){var b=l.clone(a,this.getAllDimensions());return this.mapValue(this._getHookedValue(b))},getValues:function(a){var b=l.clone(a,this.getAllDimensions());return this._getHookedValues(b)},mapValue:function(a){return a},getItems:function(a){if(this.isHook()&&this._dataModel){var b=l.without(this.getAllDimensions(),"time");return this.getUnique(b).map(function(b){return a&&a.time&&(b.time=a.time),b})}return[]},getDimension:function(){return!1},getFilter:function(){return{}},getQuery:function(){var a=["property","indicator"];if(this.isHook()&&-1!==a.indexOf(this[m])){if(Object.keys(this._hooks).length<1)return l.error("Error:",this._id,"can't find any dimension"),[];var b=this.getAllDimensions(),c=l.unique(b.concat([this[n]])),d=this.getAllFilters();return{from:"data",select:c,where:d}}return[]},getScale:function(){return null==this.scale&&this.buildScale(),this.scale},buildScale:function(){if(this.isHook()){var a,b=this.scaleType||"linear";switch(this.use){case"indicator":var c=this.getLimits(this[n]);a=[c.min,c.max];break;case"property":a=this.getUnique(this[n]);break;case"value":default:a=[this[n]]}this.scale=d3.scale[b]().domain(a)}},getLimits:function(a){if(this.isHook()){if(a||(a="time"),this._limits[a])return this._limits[a];var b={min:0,max:0},c=this._items.map(function(b){return"time"!==a?parseFloat(b[a]):new Date(b[a].toString())});return c.length>0&&(b.min=Math.min.apply(null,c),b.max=Math.max.apply(null,c)),this._limits[a]=b,b}},getUnique:function(a){if(!l.isArray(a))return this.getUnique([a]);if(this.isHook()){a||(a="time");var b,c=JSON.stringify(a);if(this._unique[c])return this._unique[c];var d=this._items.map(function(b){return l.clone(b,a)});if(-1!==a.indexOf("time"))for(var e=0;e<d.length;e++)d[e].time=new Date(d[e].time);return b=l.unique(d,function(a){return JSON.stringify(a)}),this._unique[c]=b,b}},_getHookedValue:function(a){if(!this.isHook())return void l.warn("_getHookedValue method needs the model to be hooked to data.");var b;return b="value"===this[m]?this[n]:this._hooks.hasOwnProperty(this[m])?this.getHook(this[m])[this[n]]:h(this,a,this[m],this[n])},_getHookedValues:function(a){var b=this;if(!this.isHook())return void l.warn("_getHookedValue method needs the model to be hooked to data.");var c;if("value"===this[m])c=[this[n]];else if(this._hooks.hasOwnProperty(this[m]))c=[this.getHook(this[m])[this[n]]];else if(a&&a.hasOwnProperty("time")){var d=new Date(a.time),e=_interpolateValue(this,a,this[m],this[n]);c=l.filter(this._items,a).filter(function(a){return a.time<=d}).map(function(a){return a[b[n]]}).concat(e)}else c=this._items.filter(a).map(function(a){return a[b[n]]});return c},getMaxMinMean:function(a){var b=this,c={};return d3.nest().key(function(b){return a(b.time)}).entries(b._items).forEach(function(a){var d=a.values.filter(function(a){return null!=a[b[n]]}).map(function(a){return+a[b[n]]});c[a.key]={max:d3.max(d),min:d3.min(d),mean:d3.mean(d)}}),c},_getFilteredItems:function(a){var b=(JSON.stringify(a),JSON.stringify(a));return this._filtered[b]?this._filtered[b]:this._filtered[b]=l.filter(this._items,a)}});j.Model=o}.call(this),function(){"use strict";function a(b,d){var e=/<[a-z][\s\S]*>/i.test(b)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+b.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):f[b]=f[b]||a(c.document.getElementById(b).innerHTML);return d?e(d):e}var b="vzb-loading",c=this,d=c.Vizabi,e=d.utils,f={},g=d.Events.extend({init:function(a,b){if(this._id=this._id||e.uniqueId("c"),this._ready=!1,this._readyOnce=!1,this.name=this.name||a.name,this.template=this.template||"<div></div>",this.placeholder=this.placeholder||a.placeholder,this.template_data=this.template_data||{name:this.name},this.placeholder&&!e.isElement(this.placeholder))try{this.placeholder=b.placeholder.querySelector(this.placeholder)}catch(c){e.error("Error finding placeholder '"+this.placeholder+"' for component '"+this.name+"'")}this.parent=b||this,this.components=this.components||[],this._components_config=this.components.map(function(a){return e.clone(a)}),this._frameRate=10,this.model_expects=this.model_expects||[],this.model_binds=this.model_binds||{},this.ui=this.ui||a.ui,this._super();var d=this;this.on({dom_ready:function(){"function"==typeof d.domReady&&d.domReady()},ready:function(){"function"==typeof d.ready&&d.ready()},resize:function(){"function"==typeof d.resize&&d.resize()}})},render:function(){function a(){c.trigger("dom_ready"),e.removeClass(c.placeholder,b),c._ready=!0,c._readyOnce||(c._readyOnce=!0),c.trigger("ready")}var c=this;this.loadTemplate(),this.loadComponents(),e.forEach(this.components,function(a){a.render(),c.on("resize",function(){a.trigger("resize")})}),this.isRoot()&&this.model?(this.model.on("ready",function(){a()}),this.model.setHooks(),this.model.load()):a()},loadTemplate:function(){var c=this.template,d=this.template_data,f=this,g="";if(this.placeholder){if(this.template)try{g=a(c,d)}catch(h){e.error("Templating error for component: '"+this.name+"' - Check if path to template is correct. E.g.: 'src/components/...'")}e.addClass(this.placeholder,b),this.placeholder.innerHTML=g,this.element=this.placeholder.children[0],this.layout&&(this.layout.setContainer(this.placeholder),this.layout.on("resize",function(){f._ready&&e.throttle(function(){f.trigger("resize")},f._frameRate)}))}},loadComponents:function(){var a,b,c=this;this.components=[],this.model&&this.model.resetDeps(),e.forEach(this._components_config,function(f){if(!f.component)return void e.error("Error loading component: name not provided");if(b=d.Component.get(f.component)){a=e.extend(f,{name:f.component,ui:c._uiMapping(f.placeholder,f.ui)});var g=new b(a,c),h=f.model||[];g.model=c._modelMapping(g.name,h,g.model_expects,g.model_binds),c.model&&c.model.addDep(g.model),c.components.push(g)}})},isRoot:function(){return this.parent===this},getLayoutProfile:function(){return this.layout?this.layout.currentProfile():this.parent.getLayoutProfile()},_uiMapping:function(a,b){if(b)return new d.Model(b);if(a&&this.ui){a=a.replace(".","");var c=this.ui[a];if(c)return c}return this.ui},_modelMapping:function(a,b,c,f){function g(){var a=m.getSubmodels();for(var b in m.get())"undefined"!=typeof m[b]._id&&!function(b,c){b[c].on({set:function(d,f){d=d.replace("set","set:"+c),b.trigger(d,f);var g=!0;e.forEach(a,function(a){a._set!==!0&&(g=!1)}),g&&b.trigger("set",f)},init:function(a,d){a=a.replace("init","init:"+c),b.triggerAll(a,b.getObject())},change:function(a,d){a=a.replace("change","change:"+c),b.triggerAll(a,b.getObject())},load_start:function(a,d){a=a.replace("load_start","load_start:"+c),b.triggerAll(a,d)},load_error:function(a,d){a=a.replace("load_error","load_error:"+c),b.triggerAll(a,d)},ready:function(a,d){a=a.replace("ready","ready:"+c),b.trigger(a,d),b.setReady()}})}(m,b)}function h(a){for(var b=a.split("."),c=i.model,d="";b.length;)d=b.shift(),c=c[d];return{name:a,model:c,type:c.getType()}}var i=this,j={};if(e.isArray(b)&&e.isArray(c)){c.length!==b.length&&(e.groupCollapsed("DIFFERENCE IN NUMBER OF MODELS EXPECTED AND RECEIVED"),e.warn("Please, configure the 'model_expects' attribute accordingly in '"+a+"' or check the models passed in '"+i.name+"'. [ADD LINK TO DOCUMENTATION]\n\nComponent: '"+i.name+"'\nSubcomponent: '"+a+"'\nNumber of Models Expected: "+c.length+"\nNumber of Models Received: "+b.length),e.groupEnd()),e.forEach(b,function(d,f){var g,k=h(d);c[f]?(g=c[f].name,c[f].type&&k.type!==c[f].type&&(e.groupCollapsed("UNEXPECTED MODEL TYPE: '"+k.type+"' instead of '"+c[f].type+"'"),e.warn("Please, configure the 'model_expects' attribute accordingly in '"+a+"' or check the models passed in '"+i.name+"'. [ADD LINK TO DOCUMENTATION]\n\nComponent: '"+i.name+"'\nSubcomponent: '"+a+"'\nExpected Model: '"+c[f].type+"'\nReceived Model'"+k.type+"'\nModel order: "+f),e.groupEnd())):(e.groupCollapsed("UNEXPECTED MODEL: '"+b[f]+"'"),e.warn("Please, configure the 'model_expects' attribute accordingly in '"+a+"' or check the models passed in '"+i.name+"'. [ADD LINK TO DOCUMENTATION]\n\nComponent: '"+i.name+"'\nSubcomponent: '"+a+"'\nNumber of Models Expected: "+c.length+"\nNumber of Models Received: "+b.length),e.groupEnd(),g=k.name),j[g]=k.model});var k=b.length,l=c.length;l>k&&(c.splice(0,k),e.forEach(l,function(a){j[a.name]={}}));var m=new d.Model(j,null,f);return g(),m}},getTranslationFunction:function(a){var b;try{b=this.model.get("language").getTFunction()}catch(c){this.parent&&this.parent!=this&&(b=this.parent.getTranslationFunction())}return b||(b=function(a){return a}),a?this._translatedStringFunction(b):b},_translatedStringFunction:function(a){return function(b){var c=a(b);return'<span data-vzb-translate="'+b+'">'+c+"</span>"}},translateStrings:function(){var a=this.getTranslationFunction(),b=this.placeholder.querySelectorAll("[data-vzb-translate]");e.forEach(b,function(b){b.innerHTML=a(b.getAttribute("data-vzb-translate"))})},isTool:function(){return"t"===this._id[0]},domReady:function(){},ready:function(){},resize:function(){}});g.isComponent=function(a){return a._id&&("t"===a._id[0]||"c"===a._id[0])},d.Component=g}.call(this),function(){"use strict";function a(a,b){function c(){var e=JSON.stringify(a.getObject()),f=arguments[0]||0;this._readyOnce?b():b(this);var g=JSON.stringify(a.getObject());f>=d?h.error("Max validation loop."):e!==g&&c.call(this,[++f])}var d=10;return c}function b(a,c){for(var d in c){var e=c[d],f=a[d],g=h.isObject(e)?e._type_:null,i=h.isObject(e)?e._defs_:null,j=h.isObject(e)?e._opts_:null;g?("number"===g&&isNaN(f)?a[d]=isNaN(i)?0:i:"string"===g&&"string"!=typeof f?a[d]="string"==typeof i?i:"":"array"!==g||h.isArray(f)?"object"!==g||h.isObject(f)?("model"===g||"hook"===g)&&(h.isObject(f)||(a[d]={}),a[d]=b(a[d],i)):a[d]=h.isObject(i)?i:{}:a[d]=h.isArray(i)?i:[],h.isArray(j)&&i&&-1===j.indexOf(a[d])&&(h.warn("Vizabi options contain invalid value for '"+d+"'. Permitted values: "+JSON.stringify(j)+". Changing to default"),a[d]=i)):"undefined"==typeof f?a[d]=e:h.isObject(e)&&h.isObject(f)&&(a[d]=b(f,e))}return a}var c="vzb-loading",d="vzb-loading-error",e="vzb-placeholder",f=this,g=f.Vizabi,h=g.utils,i=g.Model.extend({init:function(c,d,e,f){if(this._id=h.uniqueId("tm"),this._type="tool",this.validate=a(this,f),c=b(c,d),this._super(c,null,e),c.language){var g=this;this.on("change:language",function(){g.trigger("translate")})}}}),j=g.Component.extend({init:function(a,b){this._id=h.uniqueId("t"),this.layout=new g.Layout,this.template=this.template||'<div class="vzb-tool vzb-tool-'+this.name+'"><div class="vzb-tool-content"><div class="vzb-tool-stage"><div class="vzb-tool-viz"></div><div class="vzb-tool-timeslider"></div></div><div class="vzb-tool-buttonlist"></div></div></div>',this.model_binds=this.model_binds||{},this.default_options=this.default_options||{};var c=this.validate.bind(this),d=this,f=h.merge({change:function(a,b){d._ready&&(d.model.validate(),d.triggerAll(a,b))},translate:function(a,b){d._ready&&d.model.load().then(function(){d.model.validate(),d.translateStrings()})},load_start:function(){d.beforeLoading()},load_error:function(){d.errorLoading()},ready:function(a){d._ready&&d.afterLoading()}},this.model_binds);this.model=new i(b,this.default_options,f,c),this.ui=this.model.ui,this._super({name:this.name||this._id,placeholder:a},this),h.addClass(this.placeholder,e),this._bindEvents(),this.render()},_bindEvents:function(){this.model.bind&&this.on(this.model.bind.get())},setOptions:function(a,b,c){b?this.model.reset(a):this.model.set(a)},getOptions:function(){return this.model.getObject()||{}},beforeLoading:function(){h.hasClass(this.placeholder,c)||h.addClass(this.placeholder,c)},afterLoading:function(){h.removeClass(this.placeholder,c)},errorLoading:function(){h.addClass(this.placeholder,d)},validate:function(){}});j.isTool=function(a){return a._id&&"t"===a._id[0]},g.Tool=j}.call(this),function(){var a=this,b=a.document.createElement("script");b.type="text/template",b.setAttribute("id","src/components/_gapminder/timeslider/timeslider.html"),b.innerHTML='<div class="vzb-timeslider"> <div class="vzb-ts-slider-wrapper"> <svg class="vzb-ts-slider"> <g> <g class="vzb-ts-slider-axis"></g> <g class="vzb-ts-slider-slide"> <circle class="vzb-ts-slider-handle"></circle> <text class="vzb-ts-slider-value"></text> </g> </g> </svg> </div>  <div class="vzb-ts-btns"> <button class="vzb-ts-btn-play vzb-ts-btn"> <svg class="vzb-icon vzb-icon-play" width="1792" height="1792" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1576 927l-1328 738q-23 13-39.5 3t-16.5-36v-1472q0-26 16.5-36t39.5 3l1328 738q23 13 23 31t-23 31z"/></svg> </button> <button class="vzb-ts-btn-pause vzb-ts-btn"> <svg class="vzb-icon vzb-icon-pause" width="1792" height="1792" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1664 192v1408q0 26-19 45t-45 19h-512q-26 0-45-19t-19-45v-1408q0-26 19-45t45-19h512q26 0 45 19t19 45zm-896 0v1408q0 26-19 45t-45 19h-512q-26 0-45-19t-19-45v-1408q0-26 19-45t45-19h512q26 0 45 19t19 45z"/></svg> </button> </div> </div>',
a.document.body.appendChild(b)}.call(this),function(){var a=this,b=a.document.createElement("script");b.type="text/template",b.setAttribute("id","src/tools/_examples/bar-chart/bar-chart-comp.html"),b.innerHTML=' <svg class="vzb-bar-chart"> <g class="vzb-bc-graph"> <g class="vzb-bc-bars"></g> <g class="vzb-bc-bar-labels"></g> <text class="vzb-bc-axis-y-title"></text> <g class="vzb-bc-axis-x"></g> <g class="vzb-bc-axis-y"></g> <g class="vzb-bc-axis-labels">  </g> </g> </svg>',a.document.body.appendChild(b)}.call(this),function(){"use strict";var a=this,b=a.Vizabi,c=(b.Promise,b.utils);if(b._require("d3")){var d="vzb-playing",e="vzb-ts-hide-play-button",f="vzb-ts-dragging",g="vzb-ts-axis-aligned",h="vzb-ts-show-value",i="vzb-ts-show-value-when-drag-play",j={year:d3.time.format("%Y"),month:d3.time.format("%b"),week:d3.time.format("week %U"),day:d3.time.format("%d/%m/%Y"),hour:d3.time.format("%d/%m/%Y %H"),minute:d3.time.format("%d/%m/%Y %H:%M"),second:d3.time.format("%d/%m/%Y %H:%M:%S")},k={small:{margin:{top:9,right:15,bottom:10,left:15},radius:8,label_spacing:10},medium:{margin:{top:9,right:15,bottom:10,left:15},radius:10,label_spacing:12},large:{margin:{top:9,right:15,bottom:10,left:15},radius:11,label_spacing:14}};b.Component.extend("gapminder-timeslider",{init:function(a,b){this.template=this.template||"src/components/_gapminder/timeslider/timeslider.html",this.model_expects=[{name:"time",type:"time"}];var d=this;this.model_binds={change:function(a,b){d.changeTime(),d._setHandle(d.model.time.playing)}},this.ui=c.extend({show_limits:!1,show_value:!1,show_value_when_drag_play:!0,show_button:!0,class_axis_aligned:!1},a.ui,this.ui),this._super(a,b),this.width=0,this.height=0},domReady:function(){var a=this;this.element=d3.select(this.element),this.slider_outer=this.element.select(".vzb-ts-slider"),this.slider=this.slider_outer.select("g"),this.axis=this.element.select(".vzb-ts-slider-axis"),this.slide=this.element.select(".vzb-ts-slider-slide"),this.handle=this.slide.select(".vzb-ts-slider-handle"),this.valueText=this.slide.select(".vzb-ts-slider-value"),this.xScale=d3.time.scale().clamp(!0),this.xAxis=d3.svg.axis().orient("bottom").tickSize(0),this.valueText.attr("text-anchor","middle").attr("dy","-1em");var b=a._getBrushed(),c=a._getBrushedEnd();this.brush=d3.svg.brush().x(this.xScale).extent([0,0]).on("brush",b).on("brushend",c),this.slide.call(this.brush),this.slide.selectAll(".extent,.resize").remove();var a=this},ready:function(){var a=this.element.select(".vzb-ts-btn-play"),b=this.element.select(".vzb-ts-btn-pause"),c=this;a.on("click",function(){c.model.time.play()}),b.on("click",function(){c.model.time.pause()}),this.changeTime(),this._setHandle(this.model.time.playing)},changeTime:function(){this.ui.format=this.model.time.unit;var a=(this.model.time.value,this.model.time.start),b=this.model.time.end;this.format=j[this.ui.format],this.xScale.domain([a,b]),this.xAxis.tickValues([a,b]).tickFormat(this.format),this._optionClasses(),this.resize()},resize:function(){this.profile=k[this.getLayoutProfile()];var a=parseInt(this.slider_outer.style("width"),10),b=parseInt(this.slider_outer.style("height"),10);this.width=a-this.profile.margin.left-this.profile.margin.right,this.height=b-this.profile.margin.bottom-this.profile.margin.top;this.slider.attr("transform","translate("+this.profile.margin.left+","+this.profile.margin.top+")"),(this.xScale.range()[1]=1)&&this.xScale.range([0,this.width]),this.xAxis=this.xAxis.scale(this.xScale).tickPadding(this.profile.label_spacing),this.axis.attr("transform","translate(0,"+this.height/2+")").call(this.xAxis),this.slide.select(".background").attr("height",this.height),this.handle.attr("transform","translate(0,"+this.height/2+")").attr("r",this.profile.radius)},getSetProfile:function(a){return arguments.length?(k=a,this):k},getSetScaleRangeMax:function(a){return arguments.length?(this.xScale.range([0,a]),this):this.xScale.range()[1]},_getBrushed:function(){var a=this;return function(){a._blockUpdate||(a.model.time.pause(),a._optionClasses(),a._blockUpdate=!0,a.element.classed(f,!0));var b=a.brush.extent()[0];d3.event.sourceEvent&&(b=a.xScale.invert(d3.mouse(this)[0])),b-a.model.time.value!==0&&a._setTime(b),a._setHandle()}},_getBrushedEnd:function(){var a=this;return function(){a._blockUpdate=!1,a.model.time.pause(),a.element.classed(f,!1),a.model.time.snap()}},_setHandle:function(a){var b=this.model.time.value;if(this.slide.call(this.brush.extent([b,b])),this.valueText.text(this.format(b)),this.model.time.start-this.model.time.value===0&&(a=!1),a){var c=this.model.time.speed,d=this.handle.attr("cx"),e=this.xScale(b);this.handle.attr("cx",d).transition().duration(c).ease("linear").attr("cx",e),this.valueText.attr("transform","translate("+d+","+this.height/2+")").transition().duration(c).ease("linear").attr("transform","translate("+e+","+this.height/2+")")}else{var f=this.xScale(b);this.handle.attr("cx",f),this.valueText.attr("transform","translate("+f+","+this.height/2+")")}},_setTime:function(a){var b=this,c=50,d=new Date;null!=this._updTime&&d-this._updTime<c||(this._updTime=d,b.model.time.value=a)},_optionClasses:function(){var a=this.ui.show_limits,b=this.ui.show_value,c=this.ui.show_value_when_drag_play,f=this.ui.axis_aligned,j=this.ui.show_button&&this.model.time.playable;a||this.xAxis.tickValues([]).ticks(0),this.element.classed(e,!j),this.element.classed(d,this.model.time.playing),this.element.classed(h,b),this.element.classed(i,c),this.element.classed(g,f)}})}}.call(this),function(){"use strict";var a=this,b=a.Vizabi,c=b.utils;b.Model.extend("entities",{init:function(a,b,d){this._type="entities",a=c.extend({show:{},select:[],brush:[],opacityNonSelected:.3},a),this._visible=[],this._super(a,b,d)},validate:function(a){var b=this.getDimension(),c=this._visible.map(function(a){return a[b]});this.select=this.select.filter(function(a){return-1!==c.indexOf(a[b])}),this.brush=this.brush.filter(function(a){return-1!==c.indexOf(a[b])})},getDimension:function(){return this.show.dim},getFilter:function(){return this.show.filter.getObject()},getSelected:function(){var a=this.getDimension();return this.select.map(function(b){return b[a]})},selectEntity:function(a,b){var c=this.getDimension(),d=a[c];if(this.isSelected(a))this.select=this.select.filter(function(a){return a[c]!==d});else{var e={};e[c]=d,e.labelOffset=[0,0],b&&(e.trailStartTime=b(a.time)),this.select=this.select.concat(e)}},setLabelOffset:function(a,b){var d=this.getDimension(),e=a[d];c.find(this.select,function(a){return a[d]===e}).labelOffset=b,this.set("select",this.select,!0)},isSelected:function(a){var b=this.getDimension(),c=a[this.getDimension()],d=this.select.map(function(a){return a[b]});return-1!==d.indexOf(c)},clearSelected:function(){this.select=[]},highlightEntity:function(a,b){var c=this.getDimension(),d=a[c];if(!this.isHighlighted(a)){var e={};e[c]=d,b&&(e.trailStartTime=b(a.time)),this.brush=this.brush.concat(e)}},unhighlightEntity:function(a,b){var c=this.getDimension(),d=a[c];this.isHighlighted(a)&&(this.brush=this.brush.filter(function(a){return a[c]!==d}))},isHighlighted:function(a){var b=this.getDimension(),c=a[this.getDimension()],d=this.brush.map(function(a){return a[b]});return-1!==d.indexOf(c)},clearHighlighted:function(){this.brush=[]}})}.call(this),function(){"use strict";var a=this,b=a.Vizabi,c=b.utils;if(b._require("d3")){var d={year:d3.time.format("%Y"),month:d3.time.format("%Y-%m"),week:d3.time.format("%Y-W%W"),day:d3.time.format("%Y-%m-%d"),hour:d3.time.format("%Y-%m-%d %H"),minute:d3.time.format("%Y-%m-%d %H:%M"),second:d3.time.format("%Y-%m-%d %H:%M:%S")},e=Object.keys(d),f=c.values(d);b.Model.extend("time",{init:function(a,b,d){this._type="time",a=c.extend({value:"1800",start:"1800",end:"2014",playable:!0,playing:!1,loop:!1,round:!0,speed:500,unit:"year",format:"%Y",step:1,adaptMinMaxZoom:!1},a),this._super(a,b,d);var e=this;this._playing_now=!1,this.on({"change:playing":function(){e.playing===!0?e._startPlaying():e._stopPlaying()},set:function(){e.playing===!0&&e.set("playing",!0,!0),this.snap("start"),this.snap("end"),this.snap("value")}})},_formatToDates:function(){for(var a=["value","start","end"],b=0;b<a.length;b++){var d=a[b];if(!c.isDate(this[d]))for(var e=0;e<f.length;e++){var g=f[e],h=g.parse(this[d].toString());if(c.isDate(h)){this.set(d,h);break}}}},validate:function(){-1===e.indexOf(this.unit)&&(this.unit="year"),this.step<1&&(this.step="year"),c.isDate(this.start)&&c.isDate(this.end)&&c.isDate(this.value)||this._formatToDates(),this.end<this.start&&(this.end=this.start),this.value<this.start?this.value=this.start:this.value>this.end&&(this.value=this.end),this.playable===!1&&this.playing===!0&&(this.playing=!1)},play:function(){this.playing=!0},pause:function(){this.playing=!1},getRange:function(){return d3.time[this.unit].range(this.start,this.end,this.step)},getDimension:function(){return"time"},getFilter:function(){var a=d3.time.format(this.format||"%Y")(this.start),b=d3.time.format(this.format||"%Y")(this.end),c={time:[[a,b]]};return c},getFormatted:function(a,b){a||(a="%Y"),b||(b="value");var c=d3.time.format(a);return c(this[b])},snap:function(a){if(this.round){null==a&&(a="value");var b="round";"ceil"===this.round&&(b="ceil"),"floor"===this.round&&(b="floor");var c=d3.time[this.unit][b](this[a]);this.set(a,c,!0)}},_startPlaying:function(){if(this.playable&&!this._playing_now){this._playing_now=!0;var a=this,b=this.value,c=this.speed;this.snap(),a.end-b<=0&&(b=this.start,a.value=b),this._intervals.setInterval("playInterval_"+this._id,function(){return b>=a.end?void(a.loop?(b=a.start,a.value=b):a.playing=!1):(b=d3.time[a.unit].offset(b,a.step),void(a.value=b))},c),this.trigger("play")}},_stopPlaying:function(){this._playing_now=!1,this._intervals.clearInterval("playInterval_"+this._id),this.snap(),this.trigger("pause")}})}}.call(this),function(){"use strict";var a=this,b=a.Vizabi,c=b.utils;b.Model.extend("language",{init:function(a,b,d){this._type="language",a=c.extend({id:"en",strings:{}},a),this._super(a,b,d)},getUIString:function(a,b,c){return b=b||this.id,c=c||this.strings,c&&c.hasOwnProperty(b)&&c[b].hasOwnProperty(a)?c[b][a]:a},getTFunction:function(){var a=this.id,b=this.strings,c=this;return function(d){return c.getUIString(d,a,b)}}})}.call(this),function(){"use strict";var a=this,b=a.Vizabi;b.Reader.extend("inline",{init:function(a){this.name="inline",this._super(a)},read:function(){return(new b.Promise).resolve()}})}.call(this),function(){"use strict";var a=this,b=a.Vizabi,c=b.utils,d=b.Promise;b.Reader.extend("local-json",{init:function(a){this._name="local-json",this._data=[],this._basepath=a.path,this._basepath||c.error("Missing base path for local-json reader")},read:function(a,b){var e=this,f=new d,g=this._basepath.replace("{{LANGUAGE}}",b);return e._data=[],d3.json(g,function(b,d){if(b)return void c.error("Error Happened While Loading File: "+g,b);var h=d[0],i=a.where;i["geo.category"]&&(i["geo.cat"]=c.clone(i["geo.category"]),delete i["geo.category"]);for(var j in i){var k=i[j];if("*"!==k[0])if("time"!==j)h=h.filter(function(a){var b=a[j],d=-1;return c.isArray(b)||(b=[b]),c.forEach(b,function(a,b){return-1!==k.indexOf(a)?(d=b,!1):void 0}),-1!==d});else{var l=k[0],m=l[0],n=l[1]||m;h=h.filter(function(a){var b=a[j];return b>=m&&n>=b})}}h=h.map(function(b){return c.clone(b,a.select)}),e._data=h,f.resolve()}),f},getData:function(){return this._data}})}.call(this),function(){"use strict";var a=this,b=a.Vizabi,c=b.utils,d=b.Promise;b.Reader.extend("waffle-server",{init:function(a){this._name="waffle-reader",this._data=[],this._basepath=a.path||"https://waffle.gapminder.org/api/v1/query"},read:function(a,b){var e,f=this,g=new d;this._data=[];var h=a.where;h.time&&(h.time=h.time[0].join("-")),h["geo.category"]&&(h["geo.cat"]=c.clone(h["geo.category"]),delete h["geo.category"]),e={SELECT:a.select,WHERE:h,FROM:"humnum"};var i={query:[e],lang:b};return c.post(this._basepath,i,function(a){f._data=a,g.resolve()},function(){console.log("Error loading from Waffle Server:",f._basepath),g.reject("Could not read from waffle server")},!0),g},getData:function(){return this._data}})}.call(this),function(){"use strict";var a=this,b=a.Vizabi;b.Promise,b.utils;if(b._require("d3")){var c="src/tools/_examples/bar-chart/bar-chart-comp.html";b.Component.extend("gapminder-barchart",{init:function(a,b){this.name="bar-chart",this.template=c,this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"model"},{name:"language",type:"language"}];var d=this;this.model_binds={"change:time:value":function(a){d.updateEntities()},ready:function(a){d.updateIndicators(),d.resize(),d.updateEntities()}},this._super(a,b),this.xScale=null,this.yScale=null,this.cScale=d3.scale.category10(),this.xAxis=d3.svg.axisSmart(),this.yAxis=d3.svg.axisSmart()},domReady:function(){this.graph=this.element.select(".vzb-bc-graph"),this.yAxisEl=this.graph.select(".vzb-bc-axis-y"),this.xAxisEl=this.graph.select(".vzb-bc-axis-x"),this.yTitleEl=this.graph.select(".vzb-bc-axis-y-title"),this.bars=this.graph.select(".vzb-bc-bars");var a=this;this.on("resize",function(){a.updateEntities()})},updateIndicators:function(){var a=this;this.translator=this.model.language.getTFunction(),this.duration=this.model.time.speed,this.timeFormatter=d3.time.format(this.model.time.formatInput);var b=this.translator("indicator/"+this.model.marker.axis_y.value),c=this.yTitleEl.selectAll("text").data([0]);c.enter().append("text"),c.attr("y","-6px").attr("x","-9px").attr("dx","-0.72em").text(b),this.yScale=this.model.marker.axis_y.getScale(),this.xScale=this.model.marker.axis_x.getScale(),this.cScale=this.model.marker.color.getScale(),this.yAxis.tickFormat(a.model.marker.axis_y.tickFormatter),this.xAxis.tickFormat(a.model.marker.axis_x.tickFormatter)},updateEntities:function(){var a=this,b=this.model.time,c=b.value,d=b.playing?b.speed:0,e=this.model.marker.label.getItems({time:c});this.entityBars=this.bars.selectAll(".vzb-bc-bar").data(e),this.entityBars.exit().remove(),this.entityBars.enter().append("rect").attr("class","vzb-bc-bar").on("mousemove",function(a,b){}).on("mouseout",function(a,b){}).on("click",function(a,b){});this.bars.selectAll(".vzb-bc-bar");barWidth=this.xScale.rangeBand(),this.bars.selectAll(".vzb-bc-bar").attr("width",barWidth).attr("fill",function(b){return a.cScale(a.model.marker.color.getValue(b))}).attr("x",function(b){return a.xScale(a.model.marker.axis_x.getValue(b))}).transition().duration(d).ease("linear").attr("y",function(b){return a.yScale(a.model.marker.axis_y.getValue(b))}).attr("height",function(b){return a.height-a.yScale(a.model.marker.axis_y.getValue(b))})},resize:function(){var a=this;this.profiles={small:{margin:{top:30,right:20,left:40,bottom:40},padding:2,minRadius:2,maxRadius:40},medium:{margin:{top:30,right:60,left:60,bottom:40},padding:2,minRadius:3,maxRadius:60},large:{margin:{top:30,right:60,left:60,bottom:40},padding:2,minRadius:4,maxRadius:80}},this.activeProfile=this.profiles[this.getLayoutProfile()];var b=this.activeProfile.margin;this.height=parseInt(this.element.style("height"),10)-b.top-b.bottom,this.width=parseInt(this.element.style("width"),10)-b.left-b.right,this.graph.attr("transform","translate("+b.left+","+b.top+")"),"ordinal"!==this.model.marker.axis_y.scaleType?this.yScale.range([this.height,0]):this.yScale.rangePoints([this.height,0],a.activeProfile.padding).range(),"ordinal"!==this.model.marker.axis_x.scaleType?this.xScale.range([0,this.width]):this.xScale.rangePoints([0,this.width],a.activeProfile.padding).range(),this.yAxis.scale(this.yScale).orient("left").tickSize(6,0).tickSizeMinor(3,0).labelerOptions({scaleType:this.model.marker.axis_y.scaleType,toolMargin:b,limitMaxTickNumber:6}),this.xAxis.scale(this.xScale).orient("bottom").tickSize(6,0).tickSizeMinor(3,0).labelerOptions({scaleType:this.model.marker.axis_x.scaleType,toolMargin:b}),this.xAxisEl.attr("transform","translate(0,"+this.height+")").call(this.xAxis),this.xScale.rangeRoundBands([0,this.width],.1,.2),this.yAxisEl.call(this.yAxis),this.xAxisEl.call(this.xAxis)},drawBars:function(){}}),b.Tool.extend("BarChart",{init:function(a,b){this.name="bar-chart",this.components=[{component:"gapminder-barchart",placeholder:".vzb-tool-viz",model:["state.time","state.entities","state.marker","language"]},{component:"gapminder-timeslider",placeholder:".vzb-tool-timeslider",model:["state.time"]}],this.default_options={state:{_type_:"model",_defs_:{time:{_type_:"model",_defs_:{start:1952,end:2012,value:2e3,step:1,speed:300,formatInput:"%Y"}},entities:{_type_:"model",_defs_:{show:{_type_:"model",_defs_:{dim:{_type_:"string",_defs_:"geo"},filter:{_type_:"object",_defs_:{geo:["*"],"geo.category":["region"]}}}}}},marker:{_type_:"model",_defs_:{dimensions:{_type_:"array",_defs_:["entities","time"]},label:{_type_:"hook",_defs_:{use:{_type_:"string",_defs_:"property",_opts_:["property","indicator","value"]},value:{_type_:"string",_defs_:"geo.name"}}},axis_y:{_type_:"hook",_defs_:{use:{_type_:"string",_defs_:"indicator"},value:{_type_:"string",_defs_:"lex"},scaleType:{_type_:"string",_defs_:"linear"}}},axis_x:{_type_:"hook",_defs_:{use:{_type_:"string",_defs_:"property",_opts_:["property"]},value:{_type_:"string",_defs_:"geo.name"}}},color:{_type_:"hook",_defs_:{use:{_type_:"string",_defs_:"property"},value:{_type_:"string",_defs_:"geo.region"},palette:{_type_:"object",_defs_:{_default:"#ffb600",world:"#ffb600",eur:"#FFE700",afr:"#00D5E9",asi:"#FF5872",ame:"#7FEB00"}}}}}}}},data:{_type_:"model",_defs_:{reader:{_type_:"string",_defs_:"local-json"},path:{_type_:"string",_defs_:"local_data/waffles/{{LANGUAGE}}/basic-indicators.json"}}},ui:{_type_:"model",_defs_:{"vzb-tool-bar-chart":{_type_:"object",_defs_:{}}}},language:{_type_:"model",_defs_:{id:{_type_:"string",_defs_:"en"},strings:{_type_:"object",_defs_:{en:{title:"","buttons/expand":"Full screen","buttons/unexpand":"Leave full screen","buttons/lock":"Lock","buttons/find":"Find","buttons/colors":"Colors","buttons/size":"Size","buttons/more_options":"Options","indicator/lex":"Life expectancy","indicator/gdp_per_cap":"GDP per capita","indicator/pop":"Population","indicator/geo.region":"Region","indicator/geo":"Geo code","indicator/time":"","indicator/geo.category":"Geo category"}}}}}},this._super(a,b)},validate:function(a){a=this.model||a;var b=a.state.time,c=a.state.marker.label;if(c.getItems()&&!(c.getItems().length<1)){var d=c.getLimits("time").min,e=c.getLimits("time").max;b.start<d&&(b.start=d),b.end>e&&(b.end=e)}}})}}.call(this),function(){"use strict";Vizabi._require("d3")&&(d3.svg.axisSmart=function(){return function a(b){function c(a,b,c){return c.indexOf(a)===b}function d(a){if(null!=o)return void d.highlightValueRun(a);var c=a.append("g").attr("class","tick widthSampling");widthSampleT=c.append("text").text("0"),u.cssMarginTop=widthSampleT.style("margin-top"),u.cssMarginBottom=widthSampleT.style("margin-bottom"),u.cssMarginLeft=widthSampleT.style("margin-left"),u.cssMarginRight=widthSampleT.style("margin-right"),u.widthOfOneDigit=widthSampleT[0][0].getBBox().width,u.heightOfOneDigit=widthSampleT[0][0].getBBox().height,c.remove(),d.labelFactory(u),b(u.transitionDuration>0?a.transition().duration(u.transitionDuration):a);var e="top"==d.orient()||"bottom"==d.orient()?i:h,f=e==i&&d.pivot()||e==h&&!d.pivot()?k:j;a.selectAll(".vzb-axis-value").data([null]).enter().append("g").attr("class","vzb-axis-value").append("text").style("opacity",0),a.selectAll("text").each(function(a,b){var c=d3.select(this);if(null!=d.pivot()&&(c.attr("transform","rotate("+(d.pivot()?-90:0)+")"),c.style("text-anchor",f==j?"middle":"end"),c.attr("x",f==j?0:-d.tickPadding()-d.tickSize()),c.attr("y",f==j?(e==h?-1:1)*(d.tickPadding()+d.tickSize()):0),c.attr("dy",f==j?e==h?0:".72em":".32em"),null!=d.repositionLabels())){var g=d.repositionLabels()[b]||{x:0,y:0};c.attr("x",+c.attr("x")+g.x),c.attr("y",+c.attr("y")+g.y)}}),null==d.tickValuesMinor()&&d.tickValuesMinor([]);var g=a.selectAll(".tickMinor").data(s);g.exit().remove(),g.enter().append("line").attr("class","tickMinor");var l=d.tickSizeMinor().outbound,m=d.tickSizeMinor().inbound,n=d.scale();g.attr("y1",e==i?("top"==d.orient()?1:-1)*m:n).attr("y2",e==i?("top"==d.orient()?-1:1)*l:n).attr("x1",e==h?("right"==d.orient()?-1:1)*m:n).attr("x2",e==h?("right"==d.orient()?1:-1)*l:n)}function e(a,b){null==b&&(b=!0);var c=[],d=[];-1!=a.indexOf(0)&&(c.push([0]),d.push(a.indexOf(0)));for(var e=a.length;e>=1;e=4>e?e-1:e/2)c.push(a.filter(function(a,c){return c%Math.floor(e)!=0||-1!=d.indexOf(c)&&b?!1:(d.push(c),!0)}));return c}function f(a,b,c,d,e){if(null==a)return null;var f=c==h?{head:b.toolMargin.top,tail:b.toolMargin.bottom}:{head:b.toolMargin.right,tail:b.toolMargin.left},g={};return a.forEach(function(j,k){if(0==k||k==a.length-1){var l=f.head+(c==i?1:0)*d3.max(d.range())-(c==i?0:1)*d3.min(d.range())+(c==i?-1:1)*d(j)-("x"==e)*b.formatter(j).length*b.widthOfOneDigit/2-("y"==e)*b.heightOfOneDigit/2,m=Math.min(f.tail,b.widthOfOneDigit)+(c==h?1:0)*d3.max(d.range())-(c==h?0:1)*d3.min(d.range())+(c==h?-1:1)*d(j)-("x"==e)*b.formatter(j).length*b.widthOfOneDigit/2-("y"==e)*b.heightOfOneDigit/2;l>0&&(l=0),m>0&&(m=0),g[k]={x:0,y:0},g[k][e]=("y"==e&&c==h?-1:1)*(l-m)}}),a.forEach(function(f,j){if(0!=j&&j!=a.length-1){var k=Math.abs(d(f)-d(a[a.length-1]))-("y"==e&&c==i?-1:1)*g[a.length-1][e]-("x"==e)*b.widthOfOneDigit/2*b.formatter(f).length-("x"==e)*b.widthOfOneDigit/2*b.formatter(a[a.length-1]).length-("y"==e)*b.heightOfOneDigit*.7,l=Math.abs(d(f)-d(a[0]))-("y"==e&&c==h?-1:1)*g[0][e]-("x"==e)*b.widthOfOneDigit/2*b.formatter(f).length-("x"==e)*b.widthOfOneDigit/2*b.formatter(a[0]).length-("y"==e)*b.heightOfOneDigit*.7;k>0&&(k=0),l>0&&(l=0),g[j]={x:0,y:0},g[j][e]=("y"==e&&c==h?-1:1)*(k-l)}}),g}function g(a,b,c,e,f){return d.labelerOptions().isDevMode?null!=f?void console.log(a,b,c,e,f):null!=e?void console.log(a,b,c,e):null!=c?void console.log(a,b,c):null!=b?void console.log(a,b):null!=a?void console.log(a):void 0:void 0}var h="vertical axis",i="horizontal axis",j="labels stack side by side",k="labels stack top to bottom",l="optimistic approximation: labels have different lengths",m="pessimistic approximation: all labels have the largest length",n=10;d.highlightValueRun=function(a){var b="top"==d.orient()||"bottom"==d.orient()?i:h;a.selectAll(".tick").each(function(a,b){d3.select(this).select("text").transition().duration(p).ease("linear").style("opacity","none"==o?1:Math.min(1,Math.pow(Math.abs(d.scale()(a)-d.scale()(o))/(d.scale().range()[1]-d.scale().range()[0])*5,2)))}),a.select(".vzb-axis-value").transition().duration(p).ease("linear").attr("transform","none"==o?"translate(0,0)":"translate("+(b==i?d.scale()(o):0)+","+(b==h?d.scale()(o):0)+")"),a.select(".vzb-axis-value").select("text").text(d.tickFormat()("none"==o?0:o)).style("opacity","none"==o?0:1),o=null};var o=null;d.highlightValue=function(a){return arguments.length?(o=a,d):o};var p=0;d.highlightTransDuration=function(a){return arguments.length?(p=a,d):p};var q=null;d.repositionLabels=function(a){return arguments.length?(q=a,d):q};var r=!1;d.pivot=function(a){return arguments.length?(r=!!a,d):r};var s=[];d.tickValuesMinor=function(a){return arguments.length?(s=a,d):s};var t={outbound:0,inbound:0};d.tickSizeMinor=function(a,b){return arguments.length?(t={outbound:a,inbound:b||0},g("setting",t),d):t};var u={};return d.labelerOptions=function(a){return arguments.length?(u=a,d):u},d.labelFactory=function(a){function b(b,c){return null==c&&(c=a.logBase),Math.log(b)/Math.log(c)}if(this.METHOD_REPEATING="repeating specified powers",this.METHOD_DOUBLING="doubling the value",null==a&&(a={}),"linear"!=a.scaleType&&"time"!=a.scaleType&&"genericLog"!=a.scaleType&&"log"!=a.scaleType&&"ordinal"!=a.scaleType)return d.ticks(v).tickFormat(null).tickValues(null).tickValuesMinor(null).pivot(null).repositionLabels(null);if("ordinal"==a.scaleType)return d.tickValues(null);null==a.logBase&&(a.logBase=n),null==a.baseValues&&(a.stops=[1,2,5,3,7,4,6,8,9]),null==a.removeAllLabels&&(a.removeAllLabels=!1),null==a.formatterRemovePrefix&&(a.formatterRemovePrefix=!1),null==a.formatter&&(a.formatter=function(b){if("time"==a.scaleType)return b instanceof Date||(b=new Date(b)),d3.time.format("%Y")(b);var c="f",d=0;Math.abs(b)<1&&(d=1,c="r");var e="";if(a.formatterRemovePrefix)return d3.format("."+d+c)(b);switch(Math.floor(Math.log10(Math.abs(b)))){case-13:b=1e12*b,e="p";break;case-10:b=1e9*b,e="n";break;case-7:b=1e6*b,e="";break;case-6:b=1e6*b,e="";break;case-5:b=1e6*b,e="";break;case-4:break;case-3:break;case-2:break;case-1:break;case 0:break;case 1:break;case 2:break;case 3:break;case 4:break;case 5:b/=1e3,e="k";break;case 6:b/=1e6,e="M",d=1;break;case 7:b/=1e6,e="M";break;case 8:b/=1e6,e="M";break;case 9:b/=1e9,e="B",d=1;break;case 10:b/=1e9,e="B";break;case 11:b/=1e9,e="B";break;case 12:b/=1e12,e="T",d=1;break;default:return d3.format("."+d+"s")(b).replace("G","B")}return(d3.format("."+d+c)(b)+e).replace("G","B")}),a.cssLabelMarginLimit=5,(null==a.cssMarginLeft||parseInt(a.cssMarginLeft)<a.cssLabelMarginLimit)&&(a.cssMarginLeft=a.cssLabelMarginLimit+"px"),(null==a.cssMarginRight||parseInt(a.cssMarginRight)<a.cssLabelMarginLimit)&&(a.cssMarginRight=a.cssLabelMarginLimit+"px"),(null==a.cssMarginTop||parseInt(a.cssMarginTop)<a.cssLabelMarginLimit)&&(a.cssMarginTop=a.cssLabelMarginLimit+"px"),(null==a.cssMarginBottom||parseInt(a.cssMarginBottom)<a.cssLabelMarginLimit)&&(a.cssMarginBottom=a.cssLabelMarginLimit+"px"),null==a.toolMargin&&(a.toolMargin={left:30,bottom:30,right:30,top:30}),null==a.pivotingLimit&&(a.pivotingLimit=a.toolMargin[this.orient()]),null==a.showOuter&&(a.showOuter=!1),null==a.limitMaxTickNumber&&(a.limitMaxTickNumber=0);var j="top"==this.orient()||"bottom"==this.orient()?i:h;null==a.isPivotAuto&&(a.isPivotAuto=j==h),null==a.cssFontSize&&(a.cssFontSize="13px"),null==a.widthToFontsizeRatio&&(a.widthToFontsizeRatio=.75),null==a.heightToFontsizeRatio&&(a.heightToFontsizeRatio=1.2),null==a.widthOfOneDigit&&(a.widthOfOneDigit=parseInt(a.cssFontSize)*a.widthToFontsizeRatio),null==a.heightOfOneDigit&&(a.heightOfOneDigit=parseInt(a.cssFontSize)*a.heightToFontsizeRatio),g("********** "+j+" **********");var k=d.scale().domain(),o=d.scale().range(),p=(Math.abs(k[k.length-1]-k[0]),Math.abs(o[o.length-1]-o[0])),q=d3.min([k[0],k[k.length-1]]),r=d3.max([k[0],k[k.length-1]]),s=0>q&&r>0&&"time"!=a.scaleType;s&&"log"==a.scaleType&&console.error("It looks like your "+j+" log scale domain is crossing ZERO. Classic log scale can only be one-sided. If need crossing zero try using genericLog scale instead");var t=a.showOuter?[q,r]:[],u=[],v=5,w=d3.max(d3.range(q,r,(r-q)/17).concat(r).map(function(b){return a.formatter(b).length}))*a.widthOfOneDigit+parseInt(a.cssMarginLeft),x=a.isPivotAuto&&(w+d.tickPadding()+d.tickSize()>a.pivotingLimit&&j==h||!(w+d.tickPadding()+d.tickSize()>a.pivotingLimit)&&!(j==h)),y=j==i&&x||j==h&&!x,z=!y&&a.heightOfOneDigit>a.pivotingLimit;if(a.removeAllLabels)return d.tickValues([]);if(q==r)return d.tickValues([q]).ticks(1).tickFormat(a.formatter);var A=function(b,c,e,f){if(null==b||b.length<=1)return!0;if(null==e&&(e=m),null==f&&(scaleType="none"),y)return c>b.length*(a.heightOfOneDigit+parseInt(a.cssMarginTop)+parseInt(a.cssMarginBottom));var g=parseInt(a.cssMarginLeft)+parseInt(a.cssMarginRight),h=d3.max(b.map(function(b){return a.formatter(b).length}));return"log"==f?(c=Math.abs(d.scale()(d3.max(b))-d.scale()(d3.min(b))),c>d3.sum(b.map(function(b){return(a.widthOfOneDigit*(e==m?h:a.formatter(b).length)+g)*(1+Math.log10((b+"").substr(0,1)))}))):c>b.length*g+(e==m?a.widthOfOneDigit*b.length*h:0)+(e==l?a.widthOfOneDigit*b.map(function(b){return a.formatter(b)}).join("").length:0)},B=function(b,c){if(null==c||0==c.length)return!1;c instanceof Array||(c=[c]);for(var e=0;e<c.length;e++)if(b!=c[e]&&0!=b&&Math.abs(d.scale()(b)-d.scale()(c[e]))<(y?a.heightOfOneDigit:(a.formatter(b).length+a.formatter(c[e]).length)*a.widthOfOneDigit/2))return!0;return!1};if("genericLog"==a.scaleType||"log"==a.scaleType){var C=d.scale().eps?d.scale().eps():0,D=s?[0]:[],E=C>r?[]:d3.range(Math.floor(b(Math.max(C,q))),Math.ceil(b(r)),1).concat(Math.ceil(b(r))).map(function(b){return Math.pow(a.logBase,b)}),F=q>-C?[]:d3.range(Math.floor(b(Math.max(C,-r))),Math.ceil(b(-q)),1).concat(Math.ceil(b(-q))).map(function(b){return-Math.pow(a.logBase,b)});if(null==a.method){var G=s?Math.max(Math.abs(r),Math.abs(q))/C:Math.max(Math.abs(r),Math.abs(q))/Math.min(Math.abs(r),Math.abs(q));a.method=G>=10&&1024>=G?this.METHOD_DOUBLING:this.METHOD_REPEATING}if(a.method==this.METHOD_DOUBLING){var H=[];s&&t.push(0);var I=[].concat(t),J=C>r?null:4*E[Math.floor(E.length/2)-1],K=q>-C?null:4*F[Math.floor(F.length/2)-1];if(J)for(var L=J;r>=L;L*=2)H.push(L);if(J)for(var L=J/2;L>=Math.max(q,C);L/=2)H.push(L);if(K)for(var L=K;L>=q;L*=2)H.push(L);if(K)for(var L=K/2;L<=Math.min(r,-C);L/=2)H.push(L);H=H.sort(d3.ascending).filter(function(a){return a>=q&&r>=a}),u=u.concat(H),H=e(H,!1);for(var M=t,N=0;N<H.length;N++){var O=M.concat(H[N]).filter(function(a){return!B(a,I)}).filter(c);if(!A(O,p,m,"none"))break;t=O}}if(a.method==this.METHOD_REPEATING){var P=D.concat(E).concat(F).sort(d3.ascending);a.stops.forEach(function(a,b){u=u.concat(P.map(function(b){return b*a}))}),P=e(P);var I=D.concat(t),Q=!1;a.stops.forEach(function(b,d){if(0==d){for(var e=0;e<P.length;e++){var f=t.concat(P[e].map(function(a){return a*b})).filter(function(a){return!B(a,I)}).filter(function(a){return a>=q&&r>=a}).filter(c);if(!A(f,p,l,"none"))break;t=f}P=[].concat.apply([],P)}else{if(Q)return;var f=t.concat(P.map(function(a){return a*b})).filter(function(a){return a>=q&&r>=a}).filter(c);if(!A(f,p,m,"log"))return void(Q=!0);if(t.length>a.limitMaxTickNumber&&0!=a.limitMaxTickNumber)return void(Q=!0);t=f}})}}if("linear"==a.scaleType||"time"==a.scaleType){s&&t.push(0);var I=[].concat(t);v=Math.max(Math.floor(p/w),2),0!=a.limitMaxTickNumber&&v>a.limitMaxTickNumber&&(v=a.limitMaxTickNumber);var R=d.scale().ticks.apply(d.scale(),[v]).sort(d3.ascending).filter(function(a){return a>=q&&r>=a});u=u.concat(R),R=e(R,!1);for(var M=t,N=0;N<R.length;N++){var O=M.concat(R[N]).filter(function(a){return!B(a,I)}).filter(c);if(!A(O,p,m,"none"))break;t=O}t=t.filter(function(a){return!B(a,I)}).filter(c)}return null!=t&&t.length<=2&&!s&&(t=[q,r]),null!=t&&t.length<=3&&s&&(t=B(0,[q,r])?[q,r]:[q,0,r]),null!=t&&t.sort(function(a,b){return(j==i?-1:1)*(d.scale()(b)-d.scale()(a))}),z&&(t=[]),u=u.filter(function(a){return-1==t.indexOf(a)&&a>=q&&r>=a}),g("final result",t),d.ticks(v).tickFormat(a.formatter).tickValues(t).tickValuesMinor(u).pivot(x).repositionLabels(f(t,a,j,d.scale(),y?"y":"x"))},d.copy=function(){return a(d3.svg.axis())},d3.rebind(d,b,"scale","orient","ticks","tickValues","tickFormat","tickSize","innerTickSize","outerTickSize","tickPadding","tickSubdivide")}(d3.svg.axis())})}.call(this),function(){"use strict";Vizabi._require("d3")&&(d3.svg.collisionResolver=function(){return function(){function a(l){return null==e?void console.warn("D3 collision resolver stopped: missing data to work with. Example: data = {asi: {valueY: 45, valueX: 87}, ame: {valueY: 987, valueX: 767}}"):null==f?void console.warn("D3 collision resolver stopped: missing a CSS slector"):null==g?void console.warn("D3 collision resolver stopped: missing height of the canvas"):null==i?void console.warn("D3 collision resolver stopped: missing pointer within data objects. Example: value = 'valueY' "):(l.each(function(a,b){c[a.geo]=d3.select(this).select(f)[0][0].getBBox().height}),d=a.calculatePositions(e,i,g,h),void l.each(function(a,c){if(!e[a.geo][j]){var g=d[a.geo]||h(e[a.geo][i])||0,l=null;return null!=k?void k(a,c,this,l,g):void d3.select(this).selectAll(f).transition().duration(b).attr("transform","translate(0,"+g+")")}}))}var b=300,c={},d={};a.calculatePositions=function(a,b,d,e){var f={},g=Object.keys(a).sort(function(c,d){return a[c][b]-a[d][b]});g.forEach(function(d,h){f[d]=e(a[d][b]);for(var i=h;i>0;i--){
var j=f[g[i-1]]-f[g[i]]-c[g[i]];if(0>j&&(f[g[i-1]]-=j),j>0)break}});var h=d-f[g[0]]-c[g[0]];if(0>h){f[g[0]]+=h;for(var i=0;i<g.length-1;i++){var h=f[g[i]]-f[g[i+1]]-c[g[i+1]];if(0>h&&(f[g[i+1]]+=h),h>0)break}}return f};var e=null;a.data=function(b){return arguments.length?(e=b,a):e};var f=null;a.selector=function(b){return arguments.length?(f=b,a):f};var g=null;a.height=function(b){return arguments.length?(g=b,a):g};var h=d3.scale.linear().domain([0,1]).range([0,1]);a.scale=function(b){return arguments.length?(h=b,a):h};var i=null;a.value=function(b){return arguments.length?(i=b,a):i};var j=null;a.fixed=function(b){return arguments.length?(j=b,a):j};var k=null;return a.handleResult=function(b){return arguments.length?(k=b,a):k},a}()})}.call(this),function(){"use strict";Vizabi._require("d3")&&(d3.svg.colorPicker=function(){return function(){function a(){for(var a=[],c=0;f>c;c++){var l=g+(1-g)/f*c;a.push([]);for(var m=0;d>=m;m++){var n=e+(1-e)/d*m;a[c].push({display:b(n,0==m?k:h,0==c?i:l),meaning:b(n,0==m?k:h,0==c?j:l)})}}return a}function b(a,b,c){var d,e,f;if(0==b)d=e=f=c;else{var g=function(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+(b-a)*(2/3-c)*6:a},h=.5>c?c*(1+b):c+b-c*b,i=2*c-h;d=g(i,h,a+1/3),e=g(i,h,a),f=g(i,h,a-1/3)}return"#"+Math.round(255*d).toString(16)+Math.round(255*e).toString(16)+Math.round(255*f).toString(16)}function c(b){q=a(),t=b.append("svg").style("position","absolute").style("top","0").style("left","0").style("width","100%").style("height","100%").attr("class",p.COLOR_PICKER).classed(p.INVISIBLE,!v);var c=parseInt(t.style("width")),d=parseInt(t.style("height")),e=c/2*(1-m.left-m.right);y=t.append("rect").attr("width",c).attr("height",d).attr("class",p.COLOR_BUTTON+" "+p.COLOR_BACKGR).on("mouseover",function(a){C(n)});var g=t.append("g").attr("transform","translate("+(e+c*m.left)+","+(e+d*m.top)+")");t.append("rect").attr("class",p.COLOR_SAMPLE).attr("width",c/2).attr("height",d*m.top/2),w=t.append("rect").attr("class",p.COLOR_SAMPLE).attr("width",c/2).attr("x",c/2).attr("height",d*m.top/2),t.append("text").attr("x",c*m.left).attr("y",d*m.top/2).attr("dy","0.5em").style("text-anchor","start").attr("class",p.COLOR_SAMPLE),x=t.append("text").attr("x",c*(1-m.right)).attr("y",d*m.top/2).attr("dy","0.5em").style("text-anchor","end").attr("class",p.COLOR_SAMPLE),t.append("text").attr("x",.1*c).attr("y",d*(1-m.bottom)).attr("dy","0.3em").style("text-anchor","start").text("default"),t.append("circle").attr("class",p.COLOR_DEFAULT+" "+p.COLOR_BUTTON).attr("r",c*m.left/2).attr("cx",c*m.left*1.5).attr("cy",d*(1-1.5*m.bottom)).on("mouseover",function(){d3.select(this).style("stroke","#444"),C(o)}).on("mouseout",function(){d3.select(this).style("stroke","none")}),g.append("circle").attr("r",l-1).attr("fill","#FFF").attr("class",p.COLOR_BUTTON).on("mouseover",function(){d3.select(this).style("stroke","#444"),C("#FFF")}).on("mouseout",function(){d3.select(this).style("stroke","none")}),g.selectAll("."+p.COLOR_CIRCLE).data(q).enter().append("g").attr("class",p.COLOR_CIRCLE).each(function(a,b){r.outerRadius(l+(e-l)/f*(f-b)).innerRadius(l+(e-l)/f*(f-b-1));var c=d3.select(this).selectAll("."+p.COLOR_SEGMENT).data(s(a)).enter().append("g").attr("class",p.COLOR_SEGMENT);c.append("path").attr("class",p.COLOR_BUTTON).attr("d",r).style("fill",function(a){return a.data.display}).style("stroke",function(a){return a.data.display}).on("mouseover",function(a){C(a.data.meaning,this)}).on("mouseout",function(a){D()})}),u=g.append("path").attr("class",p.COLOR_POINTER+" "+p.INVISIBLE),t.selectAll("."+p.COLOR_BUTTON).on("click",function(){B.show(E)}),A(t)}var d=15,e=0,f=4,g=.5,h=.7,i=.4,j=.3,k=0,l=15,m={top:.1,bottom:.1,left:.1,right:.1},n="#000",o="#000",p={INVISIBLE:"vzb-invisible",COLOR_POINTER:"vzb-colorPicker-colorPointer",COLOR_BUTTON:"vzb-colorPicker-colorCell",COLOR_DEFAULT:"vzb-colorPicker-defaultColor",COLOR_SAMPLE:"vzb-colorPicker-colorSample",COLOR_PICKER:"vzb-colorPicker-colorPicker",COLOR_CIRCLE:"vzb-colorPicker-colorCircle",COLOR_SEGMENT:"vzb-colorPicker-colorSegment",COLOR_BACKGR:"vzb-colorPicker-background"},q=[],r=d3.svg.arc(),s=d3.layout.pie().sort(null).value(function(a){return 1}),t=null,u=null,v=!1,w=null,x=null,y=null,z=function(a){console.info("Color picker callback example. Setting color to "+a)},A=function(a){a.select("."+p.COLOR_BACKGR).style("fill","white"),a.select("."+p.COLOR_POINTER).style("stroke-width",2).style("stroke","white").style("pointer-events","none").style("fill","none"),a.selectAll("."+p.COLOR_BUTTON).style("cursor","pointer"),a.selectAll("text").style("dominant-baseline","hanging").style("fill","#D9D9D9").style("font-size","0.7em").style("text-transform","uppercase"),a.selectAll("circle."+p.COLOR_BUTTON).style("stroke-width",2)},B=c,C=function(a,b){null!=b&&u.classed(p.INVISIBLE,!1).attr("d",d3.select(b).attr("d")),w.style("fill",a),x.text(a),z(a)},D=function(){u.classed(p.INVISIBLE,!0)},E="toggle";return c.show=function(a){return arguments.length?(null==t&&console.warn("Color picker is missing SVG element. Was init sequence performed?"),v=a==E?!v:a,void t.classed(p.INVISIBLE,!v)):v},c.nCellsH=function(a){return arguments.length?(d=a,c):d},c.minH=function(a){return arguments.length?(e=a,c):e},c.nCellsL=function(a){return arguments.length?(f=a,c):f},c.minL=function(a){return arguments.length?(g=a,c):g},c.outerL_display=function(a){return arguments.length?(i=a,c):i},c.outerL_meaning=function(a){return arguments.length?(j=a,c):j},c.satConstant=function(a){return arguments.length?(h=a,c):h},c.firstAngleSat=function(a){return arguments.length?(k=a,c):k},c.minRadius=function(a){return arguments.length?(l=a,c):l},c.margin=function(a){return arguments.length?(m=a,c):m},c.callback=function(a){return arguments.length?(z=a,c):z},c.colorDef=function(a){return arguments.length?(o=a,null==t&&console.warn("Color picker is missing SVG element. Was init sequence performed?"),t.select("."+p.COLOR_DEFAULT).style("fill",o),c):o},c.colorOld=function(a){return arguments.length?(n=a,null==t&&console.warn("Color picker is missing SVG element. Was init sequence performed?"),t.select("rect."+p.COLOR_SAMPLE).style("fill",n),t.select("text."+p.COLOR_SAMPLE).text(n),c):n},c}()})}.call(this),function(){"use strict";Vizabi._require("d3")&&(d3.scale.genericLog=function(){return function a(b){function c(a){var c=1,e=0,h=0,k=0,l=f[0]<f[f.length-1],m=g[0]<g[g.length-1];if(d3.min(f)<0&&d3.max(f)>0){var n=d3.min(j([f[0],f[f.length-1]]));c=l!=m?(d3.max(g)+d3.max(g)-b(Math.max(d,n)))/d3.max(g):(d3.max(g)+b(Math.max(d,n)))/d3.max(g),l&&!m?(e=(d3.max(g)+i(0))/c,j(f[0])>j(f[f.length-1])&&(k-=b(Math.max(d,n))/c)):l||m?l&&m?(k=d3.max(g)/c,j(f[0])<j(f[f.length-1])&&(k-=(d3.max(g)-b(Math.max(d,n)))/c)):!l&&m&&(e=(d3.max(g)+i(0))/c,j(f[0])<j(f[f.length-1])&&(k-=b(Math.max(d,n))/c)):(k=b(Math.max(d,n))/c,j(f[0])<j(f[f.length-1])&&(k+=(d3.max(g)-b(Math.max(d,n)))/c))}else d3.min(f)<0&&d3.max(f)<0&&(e=d3.max(g));return a>d?b(a)/c+k+h:-d>a?-b(-a)/c+k+e:a>=0&&d>=a?i(a)/c+k+h:a>=-d&&0>a?-i(-a)/c+k+e:void 0}var d=.001,e=5,f=b.domain(),g=b.range(),h=!1,i=d3.scale.linear().domain([0,d]).range([0,e]),j=function(a){return a instanceof Array?a.map(function(a){return Math.abs(a)}):Math.abs(a)},k=function(a){for(var b=Math.sign(a[0]),c=0;c<a.length;c++)if(Math.sign(a[c])!=b)return!1;return!0};return c.eps=function(a){return arguments.length?(d=a,c.domain(f),c):d},c.delta=function(a){return arguments.length?(e=a,c.range(g),c):e},c.domain=function(a){if(!arguments.length)return f;var e=[];switch(2!=a.length&&console.warn("generic log scale is best for 2 values in domain, but it tries to support other cases too"),a.length){case 0:e=f;break;case 1:e=[a[0]/2,2*a[0]];break;case 2:e=[a[0],a[1]];break;case 3:e=[a[0],a[2]],d=j(a[1]);break;default:e=[a[0],a[a.length-1]],d=d3.min(j(a.filter(function(b,c){return 0!=c&&c!=a.length-1})))}return e[0]==e[1]&&(e[0]=e[0]/2,e[1]=2*e[1]),k(e)&&d3.min(j(e))>=d?(e[0]>0&&e[1]>0?b.domain(e):b.domain([-e[1],-e[0]]),h=!1):k(e)&&d3.min(j(e))<d?(e[0]>0&&e[1]>0?e[0]<=e[1]?(b.domain([d,e[1]]),i.domain([0,d])):(b.domain([e[0],d]),i.domain([d,0])):e[0]<=e[1]?(b.domain([d,-e[0]]),i.domain([0,d])):(b.domain([-e[1],d]),i.domain([d,0])),h=!0):k(e)||(e[0]<=e[1]?(b.domain([d,d3.max(j(e))]),i.domain([0,d])):(b.domain([d3.max(j(e)),d]),i.domain([d,0])),h=!0),f=a,c},c.range=function(a){if(!arguments.length)return g;switch(2!=a.length&&console.warn("generic log scale is best for 2 values in range, but it tries to support other cases too"),a.length){case 0:a=g;break;case 1:a=[a[0]-100,a[0]+100];break;case 2:a=a;break;case 3:e=a[1],a=[a[0],a[2]];break;default:e=d3.min(a.filter(function(b,c){return 0!=c&&c!=a.length-1})),a=[a[0],a[a.length-1]]}return h?a[0]<a[1]?f[0]<f[f.length-1]?(b.range([e,a[1]]),i.range([0,e])):(b.range([0,a[1]-e]),i.range([a[1]-e,a[1]])):f[0]<f[f.length-1]?(b.range([a[0]-e,0]),i.range([a[0],a[0]-e])):(b.range([a[0],e]),i.range([e,0])):b.range(a),g=a,c},c.copy=function(){return a(d3.scale.log().domain([1,10])).domain(f).range(g).eps(d).delta(e)},d3.rebind(c,b,"invert","base","rangeRound","interpolate","clamp","nice","tickFormat","ticks")}(d3.scale.log().domain([1,10]))})}.call(this);